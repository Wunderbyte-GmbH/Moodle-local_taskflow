<?xml version="1.0" encoding="UTF-8"?>
<XMLDB PATH="local/taskflow/db" VERSION="2025011900" COMMENT="XMLDB file for local_taskflow plugin" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.moodle.org/xmldb/xsd/xmldb.xsd">
    <TABLES>
        <!-- Table for storing HR units -->
        <TABLE NAME="local_taskflow_units" COMMENT="Stores HR units and their criteria">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="name" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Name of the HR unit"/>
                <FIELD NAME="criteria" TYPE="text" NOTNULL="false" SEQUENCE="false" COMMENT="JSON-encoded criteria for user membership"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Timestamp of when the unit was created"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Timestamp of the last modification"/>
                <FIELD NAME="usermodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User ID of the last modifier"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="usermodified_fk" TYPE="foreign" FIELDS="usermodified" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="idx_name" UNIQUE="false" FIELDS="name"/>
                <INDEX NAME="idx_timemodified" UNIQUE="false" FIELDS="timemodified"/>
            </INDEXES>
        </TABLE>

        <!-- Table for storing parent-child relationships between units -->
        <TABLE NAME="local_taskflow_unit_relations" COMMENT="Stores parent-child relationships between HR units">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="childid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Child unit ID"/>
                <FIELD NAME="parentid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Parent unit ID"/>
                <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Timestamp of when the relationship was created"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Timestamp of the last modification"/>
                <FIELD NAME="usermodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User ID of the last modifier"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="child_parent_idx" TYPE="unique" FIELDS="childid,parentid"/>
                <KEY NAME="child_fk" TYPE="foreign" FIELDS="childid" REFTABLE="local_taskflow_units" REFFIELDS="id"/>
                <KEY NAME="parent_fk" TYPE="foreign" FIELDS="parentid" REFTABLE="local_taskflow_units" REFFIELDS="id"/>
                <KEY NAME="usermodified_fk" TYPE="foreign" FIELDS="usermodified" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="idx_childid" UNIQUE="false" FIELDS="childid"/>
                <INDEX NAME="idx_parentid" UNIQUE="false" FIELDS="parentid"/>
                <INDEX NAME="idx_timemodified" UNIQUE="false" FIELDS="timemodified"/>
            </INDEXES>
        </TABLE>

        <!-- Table for storing user memberships in units -->
        <TABLE NAME="local_taskflow_unit_members" COMMENT="Stores user memberships in HR units">
            <FIELDS>
                <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
                <FIELD NAME="unitid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Unit ID"/>
                <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User ID"/>
                <FIELD NAME="timeadded" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Timestamp of when the user was added to the unit"/>
                <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Timestamp of the last modification"/>
                <FIELD NAME="usermodified" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="User ID of the last modifier"/>
            </FIELDS>
            <KEYS>
                <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
                <KEY NAME="unit_user_idx" TYPE="unique" FIELDS="unitid,userid"/>
                <KEY NAME="unit_fk" TYPE="foreign" FIELDS="unitid" REFTABLE="local_taskflow_units" REFFIELDS="id"/>
                <KEY NAME="user_fk" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
                <KEY NAME="usermodified_fk" TYPE="foreign" FIELDS="usermodified" REFTABLE="user" REFFIELDS="id"/>
            </KEYS>
            <INDEXES>
                <INDEX NAME="idx_unitid" UNIQUE="false" FIELDS="unitid"/>
                <INDEX NAME="idx_userid" UNIQUE="false" FIELDS="userid"/>
                <INDEX NAME="idx_timemodified" UNIQUE="false" FIELDS="timemodified"/>
            </INDEXES>
        </TABLE>
    </TABLES>
</XMLDB>